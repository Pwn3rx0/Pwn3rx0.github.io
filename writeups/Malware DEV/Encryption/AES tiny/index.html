<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shellcode Encryption with Tiny AES - pwn3rx0</title>
  <meta name="description" content="Implementing minimal AES-128 encryption and decryption for shellcode payloads using the Tiny AES library in C.">
  <meta name="keywords" content="cryptography, malware-development, aes, c, evasion, cybersecurity, security, writeups, ctf, pentest, penetration testing, red team, red teaming, malware, malware development, windows internals, windows api, shellcode, payload, injection, active directory, ad, ad enumeration, kerberoasting, lateral movement, post exploitation, defense evasion, opsec, privilege escalation, blue team, incident response, andrew mamdouh, pwn3rx0, andrew_mamdouh, malware dev, encryption">
  <meta name="author" content="Andrew Mamdouh (pwn3rx0)">
  <link rel="canonical" href="/writeups/Malware DEV/Encryption/AES tiny/">
  <meta name="robots" content="index,follow,max-image-preview:large">
  <meta property="og:title" content="Shellcode Encryption with Tiny AES">
  <meta property="og:description" content="Implementing minimal AES-128 encryption and decryption for shellcode payloads using the Tiny AES library in C.">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="pwn3rx0 blog">
  <meta property="og:image" content="/writeups/writeups-images/tinyAES.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="/writeups/Malware DEV/Encryption/AES tiny/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Shellcode Encryption with Tiny AES">
  <meta name="twitter:description" content="Implementing minimal AES-128 encryption and decryption for shellcode payloads using the Tiny AES library in C.">
  <meta name="twitter:image" content="/writeups/writeups-images/tinyAES.png">
  <meta name="site-base" content="/">
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
  <link rel="icon" href="/assets/icons/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="profile-card">
        <div class="avatar">
          <img src="/assets/images/profile.jpg" alt="Andrew Mamdouh">
        </div>
        <div class="profile-name">Andrew Mamdouh</div>
        <div class="profile-nick" style="color:#8a8f98;">(pwn3rx0)</div>
        <nav class="social-tabs">
          <a class="chip" href="https://github.com/pwn3rx0">GitHub</a>
          <a class="chip" href="https://www.linkedin.com/in/andrew-mamdouh122">LinkedIn</a>
          <a class="chip" href="https://x.com/pwn3rx0">X</a>
        </nav>
      </div>
      <nav class="category-tree"></nav>
    </aside>
    <main class="main-content">
      <nav class="breadcrumbs">
      
      <a href="/">Home</a>
    
      <span class="separator">/</span>
      <a href="/category/Malware DEV/">Malware DEV</a>
    
      <span class="separator">/</span>
      <a href="/category/Malware DEV/Encryption/">Encryption</a>
    
      <span class="separator">/</span>
      <span class="current">Shellcode Encryption with Tiny AES</span>
    </nav>
      <article class="writeup">
        <header>
          <h1>Shellcode Encryption with Tiny AES</h1>
          <div class="writeup-meta">
            <div class="writeup-date">date: <time datetime="February 24, 2026 at 02:00 AM">February 24, 2026 at 02:00 AM</time></div>
            <div class="tags-row">
              <div class="tags-label">tags:</div>
              <div class="tags"><span class="tag">cryptography</span><span class="tag">malware-development</span><span class="tag">aes</span><span class="tag">c</span><span class="tag">evasion</span></div>
            </div>
            
          </div>
        </header>
        <div class="writeup-content"><h1>Using Tiny AES for Shellcode Encryption and Decryption in Visual Studio</h1>
<ul>
<li><strong>Tiny AES</strong> is a minimal and portable AES implementation in C.</li>
<li>Supports AES-128, AES-192, and AES-256 in ECB, CBC, and CTR modes.</li>
<li>Provides a simple API to perform AES encryption and decryption on binary data such as shellcode.</li>
<li>Requires proper padding of shellcode if not aligned to AES block size (16 bytes).</li>
<li>Encryption and decryption use the same key; using CBC mode requires an IV (initialization vector).</li>
</ul>
<hr>
<h3>Setup Tiny AES in Visual Studio</h3>
<ol>
<li>Download or clone the Tiny AES repository:  <a href="https://github.com/kokke/tiny-AES-c">Tiny AES</a></li>
<li>Add <code>aes.c</code> and <code>aes.h</code> files to your Visual Studio project.</li>
<li>add the Tiny AES path to include directories
<img src="/writeups/writeups-images/tinyAES.png" alt="tinyAES.png"></li>
</ol>
<hr>
<h3>Example C Code: Encrypt and Decrypt Shellcode with Tiny AES (CBC Mode)</h3>
<pre><code class="language-c">#include &lt;Windows.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &quot;aes.h&quot;

// AES parameters
#define AES_KEY_SIZE 16  // AES-128
#define AES_BLOCK_SIZE 16

// Example 16-byte AES key (must be kept secret)
static const uint8_t aes_key[AES_KEY_SIZE] = {
    0x60, 0x3d, 0xeb, 0x10, 0x15, 0xca, 0x71, 0xbe,
    0x2b, 0x73, 0xae, 0xf0, 0x85, 0x7d, 0x77, 0x81
};

// Initialization Vector for CBC (must be unique per encryption)
static const uint8_t aes_iv[AES_BLOCK_SIZE] = {
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
    0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f
};

// Pad shellcode to AES block size (simple zero padding example)
void pad_shellcode(unsigned char* buffer, size_t original_size, size_t padded_size) {
    memset(buffer + original_size, 0, padded_size - original_size);
}

int main() {
    // Original shellcode (must be multiple of AES_BLOCK_SIZE after padding)
    unsigned char shellcode[] = {
        0xfc, 0x48, 0x83, 0xe4, 0xf0, 0xe8,
        0xc0, 0x00, 0x00, 0x00, 0x41, 0x51, 0x41, 0x50, 0x52, 0x51
    };

    size_t shellcode_len = sizeof(shellcode);
    size_t padded_len = ((shellcode_len + AES_BLOCK_SIZE - 1) / AES_BLOCK_SIZE) * AES_BLOCK_SIZE;

    // Allocate buffer with padding space
    unsigned char* buffer = (unsigned char*)malloc(padded_len);
    if (!buffer) {
        printf(&quot;Memory allocation failed\n&quot;);
        return -1;
    }
    memcpy(buffer, shellcode, shellcode_len);
    pad_shellcode(buffer, shellcode_len, padded_len);

    struct AES_ctx ctx;

    // Encrypt shellcode using AES-128 CBC
    AES_init_ctx_iv(&amp;ctx, aes_key, aes_iv);
    AES_CBC_encrypt_buffer(&amp;ctx, buffer, padded_len);

    printf(&quot;Encrypted shellcode:\n&quot;);
    for (size_t i = 0; i &lt; padded_len; i++) {
        printf(&quot;0x%02x,&quot;, buffer[i]);
    }
    printf(&quot;\n&quot;);

    // Decrypt shellcode using AES-128 CBC
    AES_init_ctx_iv(&amp;ctx, aes_key, aes_iv);
    AES_CBC_decrypt_buffer(&amp;ctx, buffer, padded_len);

    printf(&quot;Decrypted shellcode:\n&quot;);
    for (size_t i = 0; i &lt; shellcode_len; i++) {
        printf(&quot;0x%02x,&quot;, buffer[i]);
    }
    printf(&quot;\n&quot;);

    free(buffer);
    return 0;
}
</code></pre>
<hr>
<h3>Notes:</h3>
<ul>
<li><strong>Padding</strong>: The shellcode must be padded to a multiple of 16 bytes since AES operates on fixed-size blocks.</li>
<li><strong>Key and IV Security</strong>: The AES key and IV must be kept confidential. IV should be unique per encryption session.</li>
<li><strong>Buffer Size</strong>: Always allocate sufficient memory for padding.</li>
<li><strong>Decryption</strong> reverses the encryption process using the same key and IV.</li>
<li><strong>CBC mode</strong> ensures more secure encryption than ECB mode by incorporating an IV.</li>
</ul>
</div>
        <nav class="post-navigation">
          <span class="nav-link disabled"><span class="nav-direction">← Previous</span><span class="nav-title">No older post</span></span>
          
      <a href="/writeups/Malware DEV/Encryption/AES tiny/" class="nav-link next-post">
        <span class="nav-direction">Next →</span>
        <span class="nav-title">Shellcode Encryption with Tiny AES</span>
      </a>
    
        </nav>
        
      <aside class="related-posts">
        <h3>Related Writeups</h3>
        <ul class="related-list">
          <li><a href="/writeups/Malware DEV/Execution/Execution/">Shellcode Execution & Injection Strategies</a></li><li><a href="/writeups/Malware DEV/Execution/Local Payload Execution/">Local Payload Execution</a></li><li><a href="/writeups/Malware DEV/Execution/Remote ShellCode Injection/">Remote Shellcode Injection</a></li>
        </ul>
      </aside>
    
      </article>
    </main>
  </div>
  <button class="mobile-menu-toggle">☰</button>
  <script src="/assets/js/main.js"></script>
  <script src="/assets/js/navigation.js"></script>
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']]
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/c.min.js" defer></script>
  <script>(function(){function _0x3a04d1(_0x155520){const _0x2eb08c=_0x155520||document['querySelector']('.writeup-content')||document,_0x855c80=Array['from'](_0x2eb08c['querySelectorAll']('pre\x20>\x20code'))['filter'](_0x194545=>!_0x194545['closest']('.code-block'));_0x855c80['forEach'](_0x24d5be=>{const _0x7285ee=_0x24d5be['parentElement'];if(!_0x7285ee||_0x7285ee['dataset']['enhanced']==='true')return;_0x7285ee['dataset']['enhanced']='true';let _0x5cc34b=Array['from'](_0x24d5be['classList']||[])['find'](_0x390b1c=>_0x390b1c['startsWith']('language-'));if(!_0x5cc34b){const _0x4823e4=_0x24d5be['textContent']||'';(/#include\s+<[^>]+>/['test'](_0x4823e4)||/\bint\s+main\s*\(/['test'](_0x4823e4)||/#include\s+<Windows\.h>/i['test'](_0x4823e4))&&(_0x24d5be['classList']['add']('language-c'),_0x5cc34b='language-c');}const _0x4219a1=(_0x5cc34b?_0x5cc34b['replace']('language-',''):'text')['toUpperCase'](),_0x1cc223=document['createElement']('div');_0x1cc223['className']='code-block';const _0x59d9d0=document['createElement']('div');_0x59d9d0['className']='code-header';const _0x18555e=document['createElement']('span');_0x18555e['className']='code-lang',_0x18555e['textContent']=_0x4219a1;const _0x2e735d=document['createElement']('button');_0x2e735d['className']='code-copy',_0x2e735d['type']='button',_0x2e735d['textContent']='Copy',_0x2e735d['addEventListener']('click',async()=>{const _0x1359bd=_0x24d5be['innerText'],_0x25944a=()=>{const _0x54beaf=document['createElement']('textarea');_0x54beaf['value']=_0x1359bd,_0x54beaf['style']['position']='fixed',_0x54beaf['style']['opacity']='0',_0x54beaf['style']['left']='-9999px',document['body']['appendChild'](_0x54beaf),_0x54beaf['focus'](),_0x54beaf['select']();try{document['execCommand']('copy'),_0x2e735d['textContent']='Copied';}catch(_0x5c3973){_0x2e735d['textContent']='Failed';}finally{document['body']['removeChild'](_0x54beaf),setTimeout(()=>_0x2e735d['textContent']='Copy',0x4b0);}};try{navigator['clipboard']&&window['isSecureContext']?(await navigator['clipboard']['writeText'](_0x1359bd),_0x2e735d['textContent']='Copied',setTimeout(()=>_0x2e735d['textContent']='Copy',0x4b0)):_0x25944a();}catch(_0x5c7295){_0x25944a();}}),_0x59d9d0['appendChild'](_0x18555e),_0x59d9d0['appendChild'](_0x2e735d);const _0x1bb392=document['createElement']('div');_0x1bb392['className']='code-content',_0x7285ee['replaceWith'](_0x1cc223),_0x1bb392['appendChild'](_0x7285ee),_0x1cc223['appendChild'](_0x59d9d0),_0x1cc223['appendChild'](_0x1bb392);if(window['hljs']&&typeof window['hljs']['highlightElement']==='function')window['hljs']['highlightElement'](_0x24d5be);else window['hljs']&&typeof window['hljs']['highlightAll']==='function'&&window['hljs']['highlightAll']();});}function _0x47e06c(_0x486223){const _0x419485=_0x486223||document['querySelector']('.writeup-content');if(!_0x419485)return;const _0x8a766b=_0x419485['querySelectorAll']('h1,h2,h3,h4,h5,h6');_0x8a766b['forEach'](_0x427de3=>{const _0x5c9915=parseInt(_0x427de3['tagName']['substring'](0x1),0xa);let _0x4ec73e=_0x427de3['nextElementSibling'];while(_0x4ec73e){if(/^H[1-6]$/['test'](_0x4ec73e['tagName'])){const _0x1c8397=parseInt(_0x4ec73e['tagName']['substring'](0x1),0xa);if(_0x1c8397<=_0x5c9915)break;}_0x4ec73e['tagName']==='P'&&_0x4ec73e['classList']['add']('indent-p'),_0x4ec73e=_0x4ec73e['nextElementSibling'];}});}function _0x533880(){window['mermaid']&&mermaid['initialize']({'startOnLoad':!![],'theme':'dark'});_0x3a04d1(),_0x47e06c();window['hljs']&&typeof window['hljs']['highlightAll']==='function'&&window['hljs']['highlightAll']();const _0x3e0ad8=document['querySelector']('.writeup-content');if(_0x3e0ad8&&window['MutationObserver']){const _0x1d6da2=new MutationObserver(()=>{_0x3a04d1(_0x3e0ad8),_0x47e06c(_0x3e0ad8),window['hljs']&&typeof window['hljs']['highlightAll']==='function'&&window['hljs']['highlightAll']();});_0x1d6da2['observe'](_0x3e0ad8,{'childList':!![],'subtree':!![]});}}window['addEventListener']('load',_0x533880);}());</script>
</body>
</html>
